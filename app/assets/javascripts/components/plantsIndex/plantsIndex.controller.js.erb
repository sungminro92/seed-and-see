angular
  .module('seedAndSee')
  .controller('PlantsIndexController', PlantsIndexController);

PlantsIndexController.$inject = ['$state','plantsService'];

function PlantsIndexController($state, plantsService) {
  var vm = this;

  vm.plants = [];
  vm.currentUserGarden = {};
  vm.currentUser = {};
  vm.gardenPlants = {};
  vm.myPlants = {};

  vm.saveToGarden = saveToGarden;
  vm.userId = {};
  var userId = vm.userId;

  activate();

  function activate() {
  plantsService
    .getPlants()
    .then(function(res) {
      console.log(res);
      vm.plants = res.data.plants;
      vm.currentUserGarden = res.data.garden;
      vm.currentUser = res.data.current_user;
      vm.gardenPlants = res.data.garden_plants;
    })
    .then(function(res) {
      if (vm.currentUserGarden.size == 1) {
        vm.myPlants == 12;
      } else if (vm.currentUserGarden.size == 1) {
        vm.myPlants == 48;
      }
    })
  }

  function saveToGarden(plant) {
    console.log(plant);
    var plant_id = plant.id;
    var plant_name = plant.name;
    var plant_icon = plant.icon;
      if (vm.currentUserGarden == null) {
        alert('you must create a garden to save garden plants!');
        $state.go('gardenNew', {userId: userId});
      } else {
        plantsService
        .saveToGarden(plant_id, plant_name, plant_icon)
        .then(function(res) {
          if(res.status == 201) {
            vm.myPlants += 1;
            alert('plant has been saved in your garden!')};
        });   
      }
      
  }

}